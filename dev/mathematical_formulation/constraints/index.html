<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Constraints · SpineOpt.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">SpineOpt.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../getting_started/installation/">Installation</a></li><li><a class="tocitem" href="../../getting_started/running_an_optimization/">Running an Optimization</a></li><li><a class="tocitem" href="../../getting_started/creating_your_own_model/">Creating Your Own Model</a></li></ul></li><li><span class="tocitem">Concept Reference</span><ul><li><a class="tocitem" href="../../concept_reference/the_basics/">Basics of the model structure</a></li><li><a class="tocitem" href="../../concept_reference/Object Classes/">Object Classes</a></li><li><a class="tocitem" href="../../concept_reference/Relationship Classes/">Relationship Classes</a></li><li><a class="tocitem" href="../../concept_reference/Parameters/">Parameters</a></li><li><a class="tocitem" href="../../concept_reference/Parameter Value Lists/">Parameter Value Lists</a></li></ul></li><li><span class="tocitem">Mathematical Formulation</span><ul><li><a class="tocitem" href="../sets/">Sets</a></li><li><a class="tocitem" href="../variables/">Variables</a></li><li class="is-active"><a class="tocitem" href>Constraints</a><ul class="internal"><li><a class="tocitem" href="#Balance-constraint-1"><span>Balance constraint</span></a></li><li><a class="tocitem" href="#Unit-operation-1"><span>Unit operation</span></a></li><li><a class="tocitem" href="#Network-constraints-1"><span>Network constraints</span></a></li><li><a class="tocitem" href="#Investments-1"><span>Investments</span></a></li><li><a class="tocitem" href="#Benders-decomposition-1"><span>Benders decomposition</span></a></li><li><a class="tocitem" href="#User-constraints-1"><span>User constraints</span></a></li></ul></li><li><a class="tocitem" href="../objective_function/">Objective</a></li></ul></li><li><span class="tocitem">Advanced Concepts</span><ul><li><a class="tocitem" href="../../advanced_concepts/temporal_framework/">Temporal Framework</a></li><li><a class="tocitem" href="../../advanced_concepts/stochastic_framework/">Stochastic Framework</a></li><li><a class="tocitem" href="../../advanced_concepts/investment_optimization/">Investment Optimization</a></li></ul></li><li><a class="tocitem" href="../../library/">Library</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Mathematical Formulation</a></li><li class="is-active"><a href>Constraints</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Constraints</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Spine-project/SpineOpt.jl/blob/master/docs/src/mathematical_formulation/constraints.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Constraints-1"><a class="docs-heading-anchor" href="#Constraints-1">Constraints</a><a class="docs-heading-anchor-permalink" href="#Constraints-1" title="Permalink"></a></h1><h2 id="Balance-constraint-1"><a class="docs-heading-anchor" href="#Balance-constraint-1">Balance constraint</a><a class="docs-heading-anchor-permalink" href="#Balance-constraint-1" title="Permalink"></a></h2><h3 id="constraint_nodal_balance-1"><a class="docs-heading-anchor" href="#constraint_nodal_balance-1">Nodal balance</a><a class="docs-heading-anchor-permalink" href="#constraint_nodal_balance-1" title="Permalink"></a></h3><p>In <strong>SpineOpt</strong>, <a href="../../concept_reference/Object Classes/#node-1">node</a> is the place where an energy balance is enforced. As universal aggregators, they are the glue that brings all components of the energy system together. An energy balance is created for each <a href="../../concept_reference/Object Classes/#node-1">node</a> for all <a href="../sets/#Sets-1">node_stochastic_time_indices</a>, unless the <a href="../../concept_reference/Parameters/#balance_type-1">balance_type</a> parameter of the node takes the value <a href="../../concept_reference/Parameter Value Lists/#balance_type_list-1">balance_type_none</a> or if the node in question is a member of a node group, for which the <a href="../../concept_reference/Parameters/#balance_type-1">balance_type</a> is <a href="../../concept_reference/Parameter Value Lists/#balance_type_list-1">balance_type_group</a>. The parameter <a href="../../concept_reference/Parameters/#nodal_balance_sense-1">nodal_balance_sense</a> defaults to equality, but can be changed to allow overproduction (<a href="../../concept_reference/Parameters/#nodal_balance_sense-1">nodal_balance_sense</a> <a href="../../concept_reference/Parameter Value Lists/#constraint_sense_list-1"><code>&gt;=</code></a>) or underproduction (<a href="../../concept_reference/Parameters/#nodal_balance_sense-1">nodal_balance_sense</a> <a href="../../concept_reference/Parameter Value Lists/#constraint_sense_list-1"><code>&lt;=</code></a>). The energy balance is enforced by the following constraint:</p><div>\[\begin{aligned}
&amp; v_{node\_injection}(n,s,t) \\
&amp; + \sum_{\substack{(conn,n&#39;,d_{in},s,t) \in connection\_flow\_indices: \\ d_{out} == :to\_node}}
 v_{connection\_flow}(conn,n&#39;,d_{in},s,t)\\
&amp; - \sum_{\substack{(conn,n&#39;,d_{out},s,t) \in connection\_flow\_indices: \\ d_{out} == :from\_node}}
 v_{connection\_flow}(conn,n&#39;,d_{out},s,t)\\
% &amp; + v_{node\_slack\_pos}(n,s,t) \\
% &amp; - v_{node\_slack\_neg}(n,s,t) \\
&amp; \{&gt;=,==,&lt;=\} \\
&amp; 0 \\
&amp; \forall (n,s,t) \in node\_stochastic\_time\_indices: \\
&amp; p_{balance\_type}(n) != balance\_type\_none \\
&amp; \nexists ng in groups(n) : balance\_type\_group \\
\end{aligned}\]</div><p>The constraint consists of the <a href="#constraint_node_injection-1">node injections</a>, the <a href="../variables/#Variables-1">net connections flows</a> and <a href="../variables/#Variables-1">node slack variables</a>.</p><h3 id="constraint_node_injection-1"><a class="docs-heading-anchor" href="#constraint_node_injection-1">Node injection</a><a class="docs-heading-anchor-permalink" href="#constraint_node_injection-1" title="Permalink"></a></h3><p>The node injection itself represents all local production and consumption, represented by the sum of all connected unit flows and the nodal demand. The node injection is created for each node in the network (unless the node is only used for parameter aggregation purposes, see <a href="../../concept_reference/the_basics/#Introduction-to-groups-of-objects-1">Introduction to groups of objects</a>).</p><div>\[\begin{aligned}
&amp; v_{node\_injection}(n,s,t) \\
&amp; == \\
&amp; + \sum_{\substack{(u,n&#39;,d_{in},s,t) \in unit\_flow\_indices: \\ d_{out} == :to\_node}}
 v_{unit\_flow}(u,n&#39;,d_{in},s,t)\\
&amp; - \sum_{\substack{(u,n&#39;,d_{out},s,t) \in unit\_flow\_indices: \\ d_{out} == :from\_node}}
 v_{unit\_flow}(u,n&#39;,d_{out},s,t)\\
&amp; - p_{demand}(n,s,t)\\
&amp; \forall (n,s,t) \in node\_stochastic\_time\_indices
\end{aligned}\]</div><h3 id="constraint_node_injection2-1"><a class="docs-heading-anchor" href="#constraint_node_injection2-1">Node injection w storage capability</a><a class="docs-heading-anchor-permalink" href="#constraint_node_injection2-1" title="Permalink"></a></h3><p>If a node corresponds to a storage node, the parameter <a href="../../concept_reference/Parameters/#has_state-1">has_state</a> should be set to <a href="../../concept_reference/Parameter Value Lists/#boolean_value_list-1">true</a> for this node. In this case the nodal injection will translate to the following constraint:</p><div>\[\begin{aligned}
&amp; v_{node\_injection}(n,s,t) \\
&amp; == \\
&amp; (v_{node\_state}(n, s, t\_before)\\
&amp; - v_{node\_state}(n, s, t) \cdot p_{state\_coeff}(n, t)) \\
&amp;   / \Delta t_{after} \\
&amp;  - v_{node\_state}(n, s, t) \cdot p_{frac\_state\_loss}(n, t) \\
&amp;  + \sum_{\substack{(n2,s,t) \in node\_state\_indices: \\ \exists diff\_coeff(n2,n)}}
v_{node\_state}(n2,s,t)\\
&amp; - \sum_{\substack{(n2,s,t) \in node\_state\_indices: \\ \exists diff\_coeff(n,n2)}}
v_{node\_state}(n2,s,t)\\
&amp; + \sum_{\substack{(u,n&#39;,d_{in},s,t) \in unit\_flow\_indices: \\ d_{out} == :to\_node}}
 v_{unit\_flow}(u,n&#39;,d_{in},s,t)\\
&amp; - \sum_{\substack{(u,n&#39;,d_{out},s,t) \in unit\_flow\_indices: \\ d_{out} == :from\_node}}
 v_{unit\_flow}(u,n&#39;,d_{out},s,t)\\
&amp; - demand(n,s,t)\\
&amp; \forall (n,t) \in node\_time\_indices : p_{has\_state}(n)\\
&amp; \forall s in stochastic\_scenario\_path
&amp; t_{before} \in t\_before\_t(t\_after=t)\\
\end{aligned}\]</div><p>Note that for simplicity, the stochastic path is assumed to be known. In the constraint <code>constraint_node_injection.jl</code> the active stochastic paths of all involved variables is retrieved beforehand.</p><h3 id="constraint_node_state_capacity-1"><a class="docs-heading-anchor" href="#constraint_node_state_capacity-1">Node state capacity</a><a class="docs-heading-anchor-permalink" href="#constraint_node_state_capacity-1" title="Permalink"></a></h3><p>To limit the storage content, the <span>$v_{node\_state}$</span> variable needs be constrained by the following equation:</p><div>\[\begin{aligned}
&amp; v_{node\_state}(n, s, t)\\
&amp; &lt;= p_{node\_state\_cap} \\
&amp; \forall (n,s,t) \in node\_stochastic\_time\_indices : p_{has\_state}(n)\\
\end{aligned}\]</div><p>The discharging and charging behavior of storage nodes can be described through unit(s), representing the link between the storage node and the supply node. Note that the dis-/charging efficiencies and capacities are properties of these units. See <a href="#constraint_unit_flow_capacity-1">the capacity coonstraint</a> and <a href="#constraint_ratio_unit_flow-1">the unit flow ratio constraints</a></p><h3 id="constraint_cyclic_node_state-1"><a class="docs-heading-anchor" href="#constraint_cyclic_node_state-1">Cyclic condition on node state variable</a><a class="docs-heading-anchor-permalink" href="#constraint_cyclic_node_state-1" title="Permalink"></a></h3><p>To ensure that the node state at the end of the optimization is at least the same value as the initial value at the beginning of the optimization (or higher), the cyclic node state constraint can be used by setting the <a href="../../concept_reference/Parameters/#cyclic_condition-1">cyclic_condition</a> of a <a href="../../concept_reference/Relationship Classes/#node__temporal_block-1">node__temporal_block</a> to <code>true</code>. This trigger the following cyclic constraint:</p><div>\[\begin{aligned}
&amp; v_{node\_state}(n, s, t)\\
&amp; &gt;= &amp; v_{node\_state}(n, s, t)\\
&amp; \forall (n,tb) \in p_{cyclic\_condition}(n,tb) : \\
&amp; \{p_{cyclic\_condition}(n,tb) == true,\\
&amp; p_{has\_state}(n) \}\\
&amp; \forall (n&#39;,t_{initial}) \in node\_time\_indices : n&#39; == n, t_{initial} == t\_before\_t(t\_after=first(t \in tb)),\\
&amp; \forall (n&#39;,t_{last}) \in node\_time\_indices : n&#39; == n, t_{last} == last(t \in tb))\\
&amp; \forall s in stochastic\_path\\
\end{aligned}\]</div><h2 id="Unit-operation-1"><a class="docs-heading-anchor" href="#Unit-operation-1">Unit operation</a><a class="docs-heading-anchor-permalink" href="#Unit-operation-1" title="Permalink"></a></h2><p>In the following, the operational constraints on the variables associated with units will be elaborated on. The static constraints, in contrast to the dynamic constraints, are addressing constraint without sequential time-coupling. It should however be noted that static constraints can still perform temporal aggregation.</p><h3 id="Static-constraints-1"><a class="docs-heading-anchor" href="#Static-constraints-1">Static constraints</a><a class="docs-heading-anchor-permalink" href="#Static-constraints-1" title="Permalink"></a></h3><p>The fundamental static constraints for units within SpineOpt relate to the relationships between commodity flows from and to units and to limits on the unit flow capacity.</p><h4 id="constraint_ratio_unit_flow-1"><a class="docs-heading-anchor" href="#constraint_ratio_unit_flow-1">Conversion constraint / limiting flow shares inprocess / relationship in process</a><a class="docs-heading-anchor-permalink" href="#constraint_ratio_unit_flow-1" title="Permalink"></a></h4><p>A <a href="../../concept_reference/Object Classes/#unit-1">unit</a> can have different commodity flows associated with it. The most simple relationship between these flows is a linear relationship between input and/or output nodes/node groups. SpineOpt holds constraints for each combination of flows and also for the type of relationship, i.e. whether it is a maximum, minimum or fixed ratio between commodity flows. Note that node groups can be used in order to aggregate flows, i.e. to give a ratio between a combination of units flows.</p><h5 id="ratio_out_in-1"><a class="docs-heading-anchor" href="#ratio_out_in-1">Ratios between output and input flows of a unit</a><a class="docs-heading-anchor-permalink" href="#ratio_out_in-1" title="Permalink"></a></h5><p>By defining the parameters <a href="../../concept_reference/Parameters/#fix_ratio_out_in_unit_flow-1">fix_ratio_out_in_unit_flow</a>, <a href="../../concept_reference/Parameters/#max_ratio_out_in_unit_flow-1">max_ratio_out_in_unit_flow</a> or <a href="../../concept_reference/Parameters/#min_ratio_out_in_unit_flow-1">min_ratio_out_in_unit_flow</a>, a ratio can be set between <strong>out</strong>going and <strong>in</strong>coming flows from and to a unit. Whenever there is only a single input node and a single output node, this relationship relates to the notion of an efficiency. Also, the ratio equation can for instance be used to relate emissions to input primary fuel flows. In the most general form of the equation, two node groups are defined (an input node group <span>$ng_{in}$</span> and an output node group <span>$ng_{out}$</span>), and a linear relationship is expressed between both node groups. Note that whenever the relationship is specified between groups of multiple nodes, there remains a degree of freedom regarding the composition of the input node flows within group <span>$ng_{in}$</span>  and the output node flows within group <span>$ng_{out}$</span>.</p><p>The constrained given below enforces a fixed, maximum or minimum ratio between outgoing and incoming <span>$v_{unit\_flow}$</span>. Note that the potential node groups, that the parameters  <a href="../../concept_reference/Parameters/#fix_ratio_out_in_unit_flow-1">fix_ratio_out_in_unit_flow</a>, <a href="../../concept_reference/Parameters/#max_ratio_out_in_unit_flow-1">max_ratio_out_in_unit_flow</a> and <a href="../../concept_reference/Parameters/#min_ratio_out_in_unit_flow-1">min_ratio_out_in_unit_flow</a> defined on, are getting internally expanded to the members of the node group within the unit_flow_indices.</p><div>\[\begin{aligned}
&amp; \sum_{\substack{(u,n,d,s,t_{out}) \in unit\_flow\_indices: \\ (u,n,d,s,t_{out}) \, \in \, (u,ng_{out},:to\_node,s,t)}} v_{unit\_flow}(u,n,d,s,t_{out}) \cdot \Delta t_{out} \\
&amp; \{ \\
&amp; ==  p_{fix\_ratio\_out\_in\_unit\_flow}(u,ng_{out},ng_{in},t), \\
&amp; &lt;= p_{max\_ratio\_out\_in\_unit\_flow}(u,ng_{out},ng_{in},t), \\
&amp; &gt;= p_{min\_ratio\_out\_in\_unit\_flow}(u,ng_{out},ng_{in},t)\\
&amp; \} \\
&amp; \cdot \sum_{\substack{(u,n,d,s,t_{in}) \in unit\_flow\_indices:\\ (u,n,d,s,t_{in}) \in (u,ng_{in},:from\_node,s,t)}} v_{unit\_flow}(u,n,d,s,t_{in}) \cdot \Delta t_{in} \\
&amp; + p_{\{fix,max,min\}\_units\_on\_coefficient\_out\_in}(u,ng_{out},ng_{in},t) \\
&amp; \sum_{\substack{(u,s,t_{units\_on}) \in units\_on\_indices:\\ &amp; (u,s,t_{units\_on}) \in (u,s,t)}} v_{units\_on}(u,s,t_{units\_on}) \cdot \\
&amp; \min(\Delta t_{units\_on},\Delta t) \\
&amp; \forall (u, ng_{out}, ng_{in}) \in ind(p_{\{fix,max,min\}\_ratio\_out\_in\_unit\_flow}), \\
&amp; \forall t \in timeslices, \forall s \in stochasticpath
\end{aligned}\]</div><p>Note that a right-hand side constant coefficient associated with the variable <a href="../variables/#Variables-1"><code>v_{units\_on}</code></a> can optionally be included, triggered by the existence of the <a href="../../concept_reference/Parameters/#fix_units_on_coefficient_out_in-1">fix_units_on_coefficient_out_in</a>, <a href="../../concept_reference/Parameters/#max_units_on_coefficient_out_in-1">max_units_on_coefficient_out_in</a>, <a href="../../concept_reference/Parameters/#min_units_on_coefficient_out_in-1">min_units_on_coefficient_out_in</a>, respectively.</p><h5 id="ratio_in_out-1"><a class="docs-heading-anchor" href="#ratio_in_out-1">Ratios between input and output flows of a unit</a><a class="docs-heading-anchor-permalink" href="#ratio_in_out-1" title="Permalink"></a></h5><p>Similarly to the ratio between outgoing and incoming unit flows, a ratio can also be defined in reverse between <strong>in</strong>coming and <strong>out</strong>going flows.</p><div>\[\begin{aligned}
&amp; \sum_{\substack{(u,n,d,s,t_{in}) \in unit\_flow\_indices: \\ (u,n,d,s,t_{in}) \, \in \, (u,ng_{in},:from\_node,s,t)}} v_{unit\_flow}(u,n,d,s,t_{in}) \cdot \Delta t_{in} \\
&amp; \{ \\
&amp; ==  p_{fix\_ratio\_in\_out\_unit\_flow}(u,ng_{in},ng_{out},t), \\
&amp; &lt;= p_{max\_ratio\_in\_out\_unit\_flow}(u,ng_{in},ng_{out},t), \\
&amp; &gt;= p_{min\_ratio\_in\_out\_unit\_flow}(u,ng_{in},ng_{out},t)\\
&amp; \} \\
&amp; \cdot \sum_{\substack{(u,n,d,s,t_{out}) \in unit\_flow\_indices:\\ (u,n,d,s,t_{in}) \in (u,ng_{in},:to\_node,s,t)}} v_{unit\_flow}(u,n,d,s,t_{out}) \cdot \Delta t_{in} \\
&amp; + p_{\{fix,max,min\}\_units\_on\_coefficient\_in\_out}(u,ng_{in},ng_{out},t) \\
&amp; \sum_{\substack{(u,s,t_{units\_on}) \in units\_on\_indices:\\ &amp; (u,s,t_{units\_on}) \in (u,s,t)}} v_{units\_on}(u,s,t_{units\_on}) \cdot \\
&amp; \min(\Delta t_{units\_on},\Delta t) \\
&amp; \forall (u, ng_{in}, ng_{out}) \in ind(p_{\{fix,max,min\}\_ratio\_in\_out\_unit\_flow}), \\
&amp; \forall t \in timeslices, \forall s \in stochasticpath
\end{aligned}\]</div><p>Note that a right-hand side constant coefficient associated with the variable <a href="../variables/#Variables-1"><code>v_{units\_on}</code></a> can optionally be included, triggered by the existence of the <a href="../../concept_reference/Parameters/#fix_units_on_coefficient_in_out-1">fix_units_on_coefficient_in_out</a>, <a href="../../concept_reference/Parameters/#max_units_on_coefficient_in_out-1">max_units_on_coefficient_in_out</a>, <a href="../../concept_reference/Parameters/#min_units_on_coefficient_in_out-1">min_units_on_coefficient_in_out</a>, respectively.</p><h5 id="ratio_in_in-1"><a class="docs-heading-anchor" href="#ratio_in_in-1">Ratios between input and input flows of a unit</a><a class="docs-heading-anchor-permalink" href="#ratio_in_in-1" title="Permalink"></a></h5><p>Similarly to the <a href="#ratio_out_in-1">ratio between outgoing and incoming units flows</a>, one can also define a fixed, maximum or minimum ratio between <strong>in</strong>coming flows of a units.</p><div>\[\begin{aligned}
&amp; \sum_{\substack{(u,n,d,s,t_{in1}) \in unit\_flow\_indices: \\ (u,n,d,s,t_{in1}) \, \in \, (u,ng_{in1},:from\_node,s,t)}} v_{unit\_flow}(u,n,d,s,t_{in1}) \cdot \Delta t_{in1} \\
&amp; \{ \\
&amp; ==  p_{fix\_ratio\_in\_in\_unit\_flow}(u,ng_{in1},ng_{in2},t), \\
&amp; &lt;= p_{max\_ratio\_in\_in\_unit\_flow}(u,ng_{in1},ng_{in2},t), \\
&amp; &gt;= p_{min\_ratio\_in\_in\_unit\_flow}(u,ng_{in1},ng_{in2},t)\\
&amp; \} \\
&amp; \cdot \sum_{\substack{(u,n,d,s,t_{in2}) \in unit\_flow\_indices:\\ (u,n,d,s,t_{in2}) \in (u,ng_{in2},:from\_node,s,t)}} v_{unit\_flow}(u,n,d,s,t_{in2}) \cdot \Delta t_{in2} \\
&amp; + p_{\{fix,max,min\}\_units\_on\_coefficient\_in\_in}(u,ng_{in1},ng_{in2},t) \\
&amp; \sum_{\substack{(u,s,t_{units\_on}) \in units\_on\_indices:\\ &amp; (u,s,t_{units\_on}) \in (u,s,t)}} v_{units\_on}(u,s,t_{units\_on}) \cdot \\
&amp; \min(\Delta t_{units\_on},\Delta t) \\
&amp; \forall (u, ng_{in1}, ng_{in2}) \in ind(p_{\{fix,max,min\}\_ratio\_in\_in\_unit\_flow}), \\
&amp; \forall t \in timeslices, \forall s \in stochasticpath
\end{aligned}\]</div><p>Note that a right-hand side constant coefficient associated with the variable <a href="../variables/#Variables-1"><code>v_{units\_on}</code></a> can optionally be included, triggered by the existence of the <a href="../../concept_reference/Parameters/#fix_units_on_coefficient_in_in-1">fix_units_on_coefficient_in_in</a>, <a href="../../concept_reference/Parameters/#max_units_on_coefficient_in_in-1">max_units_on_coefficient_in_in</a>, <a href="../../concept_reference/Parameters/#min_units_on_coefficient_in_in-1">min_units_on_coefficient_in_in</a>, respectively.</p><h5 id="ratio_out_out-1"><a class="docs-heading-anchor" href="#ratio_out_out-1">Ratios between output and output flows of a unit</a><a class="docs-heading-anchor-permalink" href="#ratio_out_out-1" title="Permalink"></a></h5><p>Similarly to the <a href="#ratio_out_in-1">ratio between outgoing and incoming units flows</a>, one can also define a fixed, maximum or minimum ratio between <strong>out</strong>going flows of a units.</p><div>\[\begin{aligned}
&amp; \sum_{\substack{(u,n,d,s,t_{out1}) \in unit\_flow\_indices: \\ (u,n,d,s,t_{out1}) \, \in \, (u,ng_{out1},:to\_node,s,t)}} v_{unit\_flow}(u,n,d,s,t_{out1}) \cdot \Delta t_{out1} \\
&amp; \{ \\
&amp; ==  p_{fix\_ratio\_out\_out\_unit\_flow}(u,ng_{out1},ng_{out2},t), \\
&amp; &lt;= p_{max\_ratio\_out\_out\_unit\_flow}(u,ng_{out1},ng_{out2},t), \\
&amp; &gt;= p_{min\_ratio\_out\_out\_unit\_flow}(u,ng_{out1},ng_{out2},t)\\
&amp; \} \\
&amp; \cdot \sum_{\substack{(u,n,d,s,t_{out2}) \in unit\_flow\_indices:\\ (u,n,d,s,t_{out2}) \in (u,ng_{out2},:to\_node,s,t)}} v_{unit\_flow}(u,n,d,s,t_{out2}) \cdot \Delta t_{out2} \\
&amp; + p_{\{fix,max,min\}\_units\_on\_coefficient\_out\_out}(u,ng_{out1},ng_{out2},t) \\
&amp; \sum_{\substack{(u,s,t_{units\_on}) \in units\_on\_indices:\\ &amp; (u,s,t_{units\_on}) \in (u,s,t)}} v_{units\_on}(u,s,t_{units\_on}) \cdot \\
&amp; \min(\Delta t_{units\_on},\Delta t) \\
&amp; \forall (u, ng_{out1}, ng_{out2}) \in ind(p_{\{fix,max,min\}\_ratio\_out\_out\_unit\_flow}), \\
&amp; \forall t \in timeslices, \forall s \in stochasticpath
\end{aligned}\]</div><p>Note that a right-hand side constant coefficient associated with the variable <a href="../variables/#Variables-1"><code>v_{units\_on}</code></a> can optionally be included, triggered by the existence of the <a href="../../concept_reference/Parameters/#fix_units_on_coefficient_out_out-1">fix_units_on_coefficient_out_out</a>, <a href="../../concept_reference/Parameters/#max_units_on_coefficient_out_out-1">max_units_on_coefficient_out_out</a>, <a href="../../concept_reference/Parameters/#min_units_on_coefficient_out_out-1">min_units_on_coefficient_out_out</a>, respectively.</p><h4 id="constraint_unit_flow_capacity-1"><a class="docs-heading-anchor" href="#constraint_unit_flow_capacity-1">Define unit/technology capacity</a><a class="docs-heading-anchor-permalink" href="#constraint_unit_flow_capacity-1" title="Permalink"></a></h4><p>In a multi-commodity setting, there can be different commodities entering/leaving a certain technology/unit. These can be energy-related commodities (e.g., electricity, natural gas, etc.), emissions, or other commodities (e.g., water, steel). The capacity of the unit must be specified for at least one of the connected nodes, and induces a constraint on the maximum commodity flows to this location in each time step. When desirable, the capacity can be specified for a number of nodes. Note that the capacity can be specified both for input and output nodes.</p><div>\[\begin{aligned}
&amp; \sum_{\substack{(u,n,d,s,t&#39;) \in unit\_flow\_indices: \\ (u,n,d,t&#39;) \, \in \, (u,ng,d,t)}} v_{unit\_flow}(u,n,d,s,t&#39;) \cdot \Delta t&#39; \\
&amp; &lt;= p_{unit\_capacity}(u,ng,d,t) \\
&amp;  \cdot p_{conv\_cap\_to\_flow}(u,ng,d,t) \\
&amp;  \cdot \sum_{\substack{(u,s,t_{units\_on}) \in units\_on\_indices:\\ \\ &amp; (u,\Delta t_{units\_on} \in (u,t)}} v_{units\_on}(u,s,t_{units\_on}) \cdot \min(t_{units\_on},\Delta t) \\
&amp; \forall (u,ng,d) \in ind(p_{unit\_capacity}), \forall t \in timeslices, \forall s \in stochasticpath
\end{aligned}\]</div><h3 id="Dynamic-constraints-1"><a class="docs-heading-anchor" href="#Dynamic-constraints-1">Dynamic constraints</a><a class="docs-heading-anchor-permalink" href="#Dynamic-constraints-1" title="Permalink"></a></h3><h4 id="Commitment-constraints-1"><a class="docs-heading-anchor" href="#Commitment-constraints-1">Commitment constraints</a><a class="docs-heading-anchor-permalink" href="#Commitment-constraints-1" title="Permalink"></a></h4><p>For modeling certain technologies/units, it is important to not only have <span>$v_{unit\_flow}$</span> variables of different commodities, but also model the online (&quot;commitment&quot;) status of the unit/technology at every time step. Therefore, an additional variable <span>$v_{units\_on}$</span> is introduced. This variable represents the number of online units of that technology (for a normal unit commitment model, this variable might be a binary, for investment planning purposes, this might also be an integer or even a continuous variable). Commitment variables will be introduced by the following constraints (with corresponding parameters):</p><ul><li>constraint on <code>units_on</code></li><li>constraint on <code>units_available</code></li><li>constraint on the unit state transition</li><li>constraint on the minimum operating point</li><li>constraint on minimum down time</li><li>constraint on minimum up time</li><li>constraint on ramp rates</li></ul><p>(TODO: add references to julia constraints and chapters in docs)</p><h5 id="constraint_units_on-1"><a class="docs-heading-anchor" href="#constraint_units_on-1">Bound on online units</a><a class="docs-heading-anchor-permalink" href="#constraint_units_on-1" title="Permalink"></a></h5><p>The number of online units need to be restricted to the number of available units:</p><div>\[\begin{aligned}
&amp;  v_{units\_on}(u,s,t) \\
&amp; &lt;= v_{units\_available}(u,s,t) \\
&amp; \forall (u,s,t) \in units\_on\_indices
\end{aligned}\]</div><h5 id="constraint_units_available-1"><a class="docs-heading-anchor" href="#constraint_units_available-1">Bound on available units</a><a class="docs-heading-anchor-permalink" href="#constraint_units_available-1" title="Permalink"></a></h5><p>The number of available units itself is constrained by the parameter <span>$p_{number\_of\_units}$</span> and the variable number of invested unit ()<span>$v_{units\_invested\_available}$</span>):</p><div>\[\begin{aligned}
&amp; v_{units\_available}(u,s,t) \\
&amp; == p_{unit\_availability\_factor}(u,s,t) \\
&amp; \cdot (p_{number\_of\_units}(u,s,t) \\
&amp; + \sum_{(u,s,t) in units\_invested\_available\_indices} v_{units\_invested\_available}(u,s,t) ) \\
&amp; \forall (u,s,t) \in units\_on\_indices
\end{aligned}\]</div><p>The investment formulation is described in chapter <a href="#Investments-1">Investments</a>. (TODO)</p><h5 id="constraint_unit_state_transition-1"><a class="docs-heading-anchor" href="#constraint_unit_state_transition-1">Unit state transition</a><a class="docs-heading-anchor-permalink" href="#constraint_unit_state_transition-1" title="Permalink"></a></h5><p>The units on status is furtheron constraint by shutting down and starting up actions. This transition is defined as follows:</p><div>\[\begin{aligned}
&amp; v_{units\_on}(u,s,t_{after}) \\
&amp; - v_{units\_started\_up}(u,s,t_{after}) \\
&amp; + v_{units\_shut\_down}(u,s,t_{after}) \\
&amp; == v_{units\_on}(u,s,t_{before}) \\
&amp; \forall (u,s,t_{after}) \in units\_on\_indices, \\
&amp; \forall t_{before} \in t\_before\_t(t\_after=t_{after}) : t_{before} \in units\_on\_indices,\\
\end{aligned}\]</div><h5 id="constraint_minimum_operating_point-1"><a class="docs-heading-anchor" href="#constraint_minimum_operating_point-1">Constraint on minimum operating point</a><a class="docs-heading-anchor-permalink" href="#constraint_minimum_operating_point-1" title="Permalink"></a></h5><p>The minimum operating point of a unit can be based on the <span>$v_{unit\_flow}$</span>&#39;s of input or output nodes/node groups ng:</p><div>\[\begin{aligned}
&amp; \sum_{\substack{(u,n,d,s,t&#39;) \in unit\_flow\_indices: \\ (u,n,d,t&#39;) \, \in \, (u,ng,d,t)}} v_{unit\_flow}(u,n,d,s,t&#39;) \cdot \Delta t&#39; \\
&amp; &gt;= p_{minimum\_operating\_point}(u,ng,d,t) \\
&amp; \cdot p_{unit\_capacity}(u,ng,d,t) \\
&amp;  \cdot \cdot p_{conv\_cap\_to\_flow}(u,ng,d,t) \\
&amp;  \cdot \sum_{\substack{(u,s,t_{units\_on}) \in units\_on\_indices:\\ \\ &amp; (u,\Delta t_{units\_on} \in (u,t)}} v_{units\_on}(u,s,t_{units\_on}) \cdot \min(t_{units\_on},\Delta t) \\
&amp; \forall (u,ng,d) \in ind(p_{minimum\_operating\_point}), \forall t \in timeslices, \forall s \in stochasticpath
\end{aligned}\]</div><h5 id="constraint_min_down_time-1"><a class="docs-heading-anchor" href="#constraint_min_down_time-1">Minimum down time (basic version)</a><a class="docs-heading-anchor-permalink" href="#constraint_min_down_time-1" title="Permalink"></a></h5><div>\[\begin{aligned}
&amp; v_{units\_available}(u,s,t) \\
&amp; - v_{units\_on}(u,s,t) \\
&amp; &gt;= \sum_{\substack{(u,s,t&#39;) \in units\_on\_indices: \\ t&#39; &gt;=t-p_{min\_down\_time} &amp;&amp; t&#39; &lt;= t}}
v_{units\_shut\_down}(u,s,t&#39;) \\
&amp; \forall (u,s,t) \in units\_on\_indices\\
\end{aligned}\]</div><p>This constraint can be extended to the use reserves. See also. (TODO)</p><h5 id="Minimum-up-time-(basic-version)-1"><a class="docs-heading-anchor" href="#Minimum-up-time-(basic-version)-1">Minimum up time (basic version)</a><a class="docs-heading-anchor-permalink" href="#Minimum-up-time-(basic-version)-1" title="Permalink"></a></h5><div>\[\begin{aligned}
&amp; v_{units\_on}(u,s,t) \\
&amp; &gt;= \sum_{\substack{(u,s,t&#39;) \in units\_on\_indices: \\ t&#39; &gt;=t-p_{min\_up\_time}, \\ t&#39; &lt;= t}}
v_{units\_started\_up}(u,s,t&#39;) \\
&amp; \forall (u,s,t) \in units\_on\_indices\\
\end{aligned}\]</div><p>This constraint can be extended to the use reserves. See <a href="#constraint_min_up_time2-1">also</a></p><h4 id="Ramping-and-reserve-constraints-1"><a class="docs-heading-anchor" href="#Ramping-and-reserve-constraints-1">Ramping and reserve constraints</a><a class="docs-heading-anchor-permalink" href="#Ramping-and-reserve-constraints-1" title="Permalink"></a></h4><p>To include ramping and reserve constraints, it is a pre requisit that minimum operation points and maximum capacity constraints are enforced as described above.</p><p>For dispatchable units, additional ramping constraints can be introduced. First, the upward ramp of a unit is split into online, start-up and non-spinning ramping contributions.</p><h4 id="constraint_split_ramps-1"><a class="docs-heading-anchor" href="#constraint_split_ramps-1">Splitting unit flows into ramps</a><a class="docs-heading-anchor-permalink" href="#constraint_split_ramps-1" title="Permalink"></a></h4><div>\[\begin{aligned}
&amp; + \sum_{\substack{(u,n,d,s,t_{after}) \in unit\_flow\_indices: \\ (u,n,d,t_{after}) \, \in \, (u,n,d,t_{after})\\ !is\_reserve(n)}} v_{unit\_flow}(u,n,d,s,t_{after}) \\
&amp; + \sum_{\substack{(u,n,d,s,t_{after}) \in unit\_flow\_indices: \\ (u,n,d,t_{after}) \, \in \, (u,n,d,t_{after})\\ is\_reserve(n) \&amp;\&amp; upward\_reserve(n)}} v_{unit\_flow}(u,n,d,s,t_{after}) \\
&amp; - \sum_{\substack{(u,n,d,s,t_{before}) \in unit\_flow\_indices: \\ (u,n,d,t_{before}) \, \in \, (u,n,d,t_{before})\\ !is\_reserve(n)}} v_{unit\_flow}(u,n,d,s,t_{before}) \\
&amp; &lt;=  \\
&amp; + \sum_{\substack{(u,n,d,s,t_{after}) \in ramp\_up\_unit\_flow\_indices: \\ (u,n,d,t_{after}) \, \in \, (u,n,d,t_{after})}} v_{ramp\_up\_unit\_flow}(u,n,d,s,t_{after})  \\
&amp; + \sum_{\substack{(u,n,d,s,t_{after}) \in start\_up\_unit\_flow\_indices: \\ (u,n,d,t_{after}) \, \in \, (u,n,d,t_{after})}} v_{start\_up\_unit\_flow}(u,n,d,s,t_{after}) \\
&amp; + \sum_{\substack{(u,n,d,s,t_{after}) \in nonspin\_ramp\_up\_unit\_flow\_indices: \\ (u,n,d,t_{after}) \, \in \, (u,n,d,t_{after})}} v_{nonspin\_ramp\_up\_unit\_flow}(u,n,d,s,t_{after}) \\
&amp; \forall (u,n,d,s,t_{after}) \in (\\
&amp; ramp\_up\_unit\_flow\_indices,\\
&amp; start\_up\_unit\_flow\_indices,\\
&amp; nonspin\_ramp\_up\_unit\_flow\_indices) \\
&amp; \forall t_{before} \in t\_before\_t(t\_after=t_{after}) : t_{before} \in unit\_flow\_indices \\
\end{aligned}\]</div><p>Similarly, the downward ramp of a unit is split into online, shut-down and non-spinning downward ramping contributions.</p><div>\[\begin{aligned}
&amp; + \sum_{\substack{(u,n,d,s,t_{before}) \in unit\_flow\_indices: \\ (u,n,d,t_{before}) \, \in \, (u,n,d,t_{before})\\ !is\_reserve(n)}} v_{unit\_flow}(u,n,d,s,t_{before}) \\
&amp; - \sum_{\substack{(u,n,d,s,t_{after}) \in unit\_flow\_indices: \\ (u,n,d,t_{after}) \, \in \, (u,n,d,t_{after}) \\ !is\_reserve(n)}} v_{unit\_flow}(u,n,d,s,t_{after}) \\
&amp; + \sum_{\substack{(u,n,d,s,t_{after}) \in unit\_flow\_indices: \\ (u,n,d,t_{after}) \, \in \, (u,n,d,t_{after}) \\ is\_reserve(n) \&amp;\&amp; downward\_reserve(n)}} v_{unit\_flow}(u,n,d,s,t_{after}) \\
&amp; &lt;=  \\
&amp; \sum_{\substack{(u,n,d,s,t_{after}) \in ramp\_down\_unit\_flow\_indices: \\ (u,n,d,t_{after}) \, \in \, (u,n,d,t_{after})}} v_{ramp\_down\_unit\_flow}(u,n,d,s,t_{after}) \\
&amp; \sum_{\substack{(u,n,d,s,t_{after}) \in shut\_down\_unit\_flow\_indices: \\ (u,n,d,t_{after}) \, \in \, (u,n,d,t_{after})}} v_{shut\_down\_unit\_flow}(u,n,d,s,t_{after}) \\
&amp; \sum_{\substack{(u,n,d,s,t_{after}) \in nonspin\_ramp\_down\_unit\_flow\_indices: \\ (u,n,d,t_{after}) \, \in \, (u,n,d,t_{after})}} v_{nonspin\_ramp\_down\_unit\_flow}(u,n,d,s,t_{after}) \\
&amp; \forall (u,n,d,s,t_{after}) \in (\\
&amp; ramp\_down\_unit\_flow\_indices,\\
&amp; shut\_down\_unit\_flow\_indices,\\
&amp; nonspin\_ramp\_down\_unit\_flow\_indices) \\
&amp; \forall t_{before} \in t\_before\_t(t\_after=t_{after}) : t_{before} \in unit\_flow\_indices \\
\end{aligned}\]</div><h5 id="constraint_ramp_up-1"><a class="docs-heading-anchor" href="#constraint_ramp_up-1">Constraint on spinning upwards ramp_up</a><a class="docs-heading-anchor-permalink" href="#constraint_ramp_up-1" title="Permalink"></a></h5><p>The online ramp up ability of a unit can be constraint by the <a href="../../concept_reference/Parameters/#ramp_up_limit-1">ramp_up_limit</a>, expressed as a share of the <a href="../../concept_reference/Parameters/#unit_capacity-1">unit_capacity</a>. With this constraint, ramps can be applied to groups of commodities (e.g. electricity + balancing capacity). Moreover, balancing product might have specific ramping requirements, which can herewith also be enforced.</p><div>\[\begin{aligned}
&amp; + \sum_{\substack{(u,n,d,s,t) \in ramp\_up\_unit\_flow\_indices: \\ (u,n,d) \, \in \, (u,ng,d)}} v_{ramp\_up\_unit\_flow}(u,n,d,s,t)  \\
&amp; &lt;= \\
&amp; + \sum_{\substack{(u,s,t&#39;) \in units\_on\_indices: \\ (u,s) \in (u,s) \\ t&#39;\in t\_overlap\_t(t)}}
 (v_{units\_on}(u,s,t&#39;)
 - v_{units\_started\_up}(u,s,t&#39;)) \\
&amp; \cdot p_{ramp\_up\_limit}(u,ng,d,s,t) \\
&amp; \cdot p_{unit\_capacity}(u,ng,d,t) \\
&amp; \cdot p_{conv\_cap\_to\_flow}(u,ng,d,t) \\
&amp; \forall (u,ng,d,s,t) \in ind(constraint\_ramp\_up)\\
\end{aligned}\]</div><h5 id="constraint_min_start_up_ramp-1"><a class="docs-heading-anchor" href="#constraint_min_start_up_ramp-1">Constraint on minimum upward start up ramp_up</a><a class="docs-heading-anchor-permalink" href="#constraint_min_start_up_ramp-1" title="Permalink"></a></h5><h5 id="constraint_max_start_up_ramp-1"><a class="docs-heading-anchor" href="#constraint_max_start_up_ramp-1">Constraint on maximum upward start up ramp_up</a><a class="docs-heading-anchor-permalink" href="#constraint_max_start_up_ramp-1" title="Permalink"></a></h5><p>This constraint enforces a limit on the unit ramp during startup process. Usually, we consider only non-balancing commodities. However, it is possible to include them, by adding them to the ramp defining node <code>ng</code>.</p><div>\[\begin{aligned}
&amp; + \sum_{\substack{(u,n,d,s,t) \in start\_up\_unit\_flow\_indices: \\ (u,n,d) \, \in \, (u,ng,d)}} v_{start\_up\_unit\_flow}(u,n,d,s,t)  \\
&amp; &lt;= \\
&amp; + \sum_{\substack{(u,s,t&#39;) \in units\_on\_indices: \\ (u,s) \in (u,s) \\ t&#39;\in t\_overlap\_t(t)}}
&amp; \cdot p_{max\_startup\_ramp}(u,ng,d,s,t) \\
&amp; \cdot p_{unit\_capacity}(u,ng,d,t) \\
&amp; \cdot p_{conv\_cap\_to\_flow}(u,ng,d,t) \\
&amp; \forall (u,ng,d,s,t) \in ind(constraint\_start\_up\_ramp)\\
\end{aligned}\]</div><h5 id="Constraint-on-upward-non-spinning-start-up-ramps-1"><a class="docs-heading-anchor" href="#Constraint-on-upward-non-spinning-start-up-ramps-1">Constraint on upward non-spinning start up ramps</a><a class="docs-heading-anchor-permalink" href="#Constraint-on-upward-non-spinning-start-up-ramps-1" title="Permalink"></a></h5><p>For non-spinning reserves, offline units can be scheduled for reserve provision if they have recovered their minimum down time. If nonspinning reserves are used the minimum down-time constraint becomes:</p><div>\[\begin{aligned}
&amp; v_{units\_available}(u,s,t) \\
&amp; - v_{units\_on}(u,s,t) \\
&amp; &gt;= \sum_{\substack{(u,s,t&#39;) \in units\_on\_indices: \\ t&#39; &gt;t-p_{min\_down\_time} &amp;&amp; t&#39; &lt;= t}}
v_{units\_shut\_down}(u,s,t&#39;) \\
&amp; \sum_{\substack{(u,n,s,t) \in nonspin\_units\_started\_up\_indices: \\ t \in t\_overlaps\_t(t) \\ (u,s) \in (u,s)}}
  v_{nonspin\_units\_started\_up}(u,n,s,t)
&amp; \forall (u,s,t) \in units\_on\_indices\\
\end{aligned}\]</div><p>TODO: add correct forall, how to simplify?</p><h5 id="constraint_min_nonspin_ramp_up-1"><a class="docs-heading-anchor" href="#constraint_min_nonspin_ramp_up-1">Minimum nonspinning ramp up</a><a class="docs-heading-anchor-permalink" href="#constraint_min_nonspin_ramp_up-1" title="Permalink"></a></h5><h5 id="constraint_max_nonspin_ramp_up-1"><a class="docs-heading-anchor" href="#constraint_max_nonspin_ramp_up-1">Maximum nonspinning ramp up</a><a class="docs-heading-anchor-permalink" href="#constraint_max_nonspin_ramp_up-1" title="Permalink"></a></h5><p>The ramp a non-spinning unit can provide is constraint through the <a href="../../concept_reference/Parameters/#max_res_startup_ramp-1">max_res_startup_ramp</a>.</p><div>\[\begin{aligned}
&amp; + \sum_{\substack{(u,n,d,s,t) \in nonspin\_ramp\_up\_unit\_flow\_indices: \\ (u,n,d,s,t)  \in (u,n,d,s,t)}} v_{nonspin\_ramp\_up\_unit\_flow}(u,n,d,s,t)  \\
&amp; &lt;= \\
&amp; + \sum_{\substack{(u,n,s,t) \in nonspin\_units\_started\_up\_indices: \\ (u,n,s,t)  \in (u,n,s,t)}} v_{nonspin\_units\_started\_up}(u,n,s,t)  \\
&amp; \cdot p_{max\_res\_startup\_ramp}(u,ng,d,s,t) \\
&amp; \cdot p_{unit\_capacity}(u,ng,d,t) \\
&amp; \cdot p_{conv\_cap\_to\_flow}(u,ng,d,t) \\
&amp; \forall (u,ng,d,s,t) \in ind(constraint\_max\_nonspin\_ramp)\\
\end{aligned}\]</div><h5 id="constraint_ramp_down-1"><a class="docs-heading-anchor" href="#constraint_ramp_down-1">Constraint on spinning downward ramps</a><a class="docs-heading-anchor-permalink" href="#constraint_ramp_down-1" title="Permalink"></a></h5><div>\[\begin{aligned}
&amp; + \sum_{\substack{(u,n,d,s,t) \in ramp\_down\_unit\_flow\_indices: \\ (u,n,d) \, \in \, (u,ng,d)}} v_{ramp\_down\_unit\_flow}(u,n,d,s,t)  \\
&amp; &lt;= \\
&amp; + \sum_{\substack{(u,s,t&#39;) \in units\_on\_indices: \\ (u,s) \in (u,s) \\ t&#39;\in t\_overlap\_t(t)}}
 (v_{units\_on}(u,s,t&#39;)
 - v_{units\_started\_up}(u,s,t&#39;)) \\
&amp; \cdot p_{ramp\_down\_limit}(u,ng,d,s,t) \\
&amp; \cdot p_{unit\_capacity}(u,ng,d,t) \\
&amp; \cdot p_{conv\_cap\_to\_flow}(u,ng,d,t) \\
&amp; \forall (u,ng,d,s,t) \in ind(constraint\_ramp\_down)\\
\end{aligned}\]</div><h5 id="constraint_min_shut_down_ramp-1"><a class="docs-heading-anchor" href="#constraint_min_shut_down_ramp-1">Lower bound on downward shut-down ramps</a><a class="docs-heading-anchor-permalink" href="#constraint_min_shut_down_ramp-1" title="Permalink"></a></h5><h5 id="constraint_max_shut_down_ramp-1"><a class="docs-heading-anchor" href="#constraint_max_shut_down_ramp-1">Upper bound on downward shut-down ramps</a><a class="docs-heading-anchor-permalink" href="#constraint_max_shut_down_ramp-1" title="Permalink"></a></h5><p>This constraint enforces a limit on the unit ramp during shutdown process. Usually, we consider only non-balancing commodities. However, it is possible to include them, by adding them to the ramp defining node <code>ng</code>.</p><div>\[\begin{aligned}
&amp; + \sum_{\substack{(u,n,d,s,t) \in shut\_down\_unit\_flow\_indices: \\ (u,n,d) \, \in \, (u,ng,d)}} v_{shut\_down\_unit\_flow}(u,n,d,s,t)  \\
&amp; &lt;= \\
&amp; + \sum_{\substack{(u,s,t&#39;) \in units\_on\_indices: \\ (u,s) \in (u,s) \\ t&#39;\in t\_overlap\_t(t)}} v_{units\_shut\_down}(u,s,t&#39;) \\
&amp; \cdot p_{max\_shutdown\_ramp}(u,ng,d,s,t) \\
&amp; \cdot p_{unit\_capacity}(u,ng,d,t) \\
&amp; \cdot p_{conv\_cap\_to\_flow}(u,ng,d,t) \\
&amp; \forall (u,ng,d,s,t) \in ind(constraint\_shut\_down\_ramp)\\
\end{aligned}\]</div><h5 id="constraint_min_up_time2-1"><a class="docs-heading-anchor" href="#constraint_min_up_time2-1">Constraint on minimum up time, including nonpinning reserves</a><a class="docs-heading-anchor-permalink" href="#constraint_min_up_time2-1" title="Permalink"></a></h5><p>For non-spinning downward reserves, online units can be scheduled for reserve provision through shut down if they have recovered their minimum up time. If nonspinning reserves are used the minimum up-time constraint becomes; TODO check this:</p><div>\[\begin{aligned}
&amp; v_{units\_on}(u,s,t) \\
&amp; &gt;= \sum_{\substack{(u,s,t&#39;) \in units\_on\_indices: \\ t&#39; &gt;t-p_{min\_up\_time} &amp;&amp; t&#39; &lt;= t}}
v_{units\_started\_up}(u,s,t&#39;) \\
&amp; \sum_{\substack{(u,n,s,t) \in nonspin\_units\_shut\_down\_indices: \\ t \in t\_overlaps\_t(t) \\ (u,s) \in (u,s)}}
  v_{nonspin\_units\_shut\_down}(u,n,s,t) \\
&amp; \forall (u,s,t) \in units\_on\_indices\\
\end{aligned}\]</div><p>TODO: add correct forall, how to simplify?</p><p>The ramp a non-spinning unit can provide is constraint through the <a href="../../concept_reference/Parameters/#max_res_shutdown_ramp-1">max_res_shutdown_ramp</a>.</p><h4 id="constraint_min_nonspin_ramp_down-1"><a class="docs-heading-anchor" href="#constraint_min_nonspin_ramp_down-1">Lower bound on the nonspinning downward reserve provision</a><a class="docs-heading-anchor-permalink" href="#constraint_min_nonspin_ramp_down-1" title="Permalink"></a></h4><h4 id="constraint_max_nonspin_ramp_down-1"><a class="docs-heading-anchor" href="#constraint_max_nonspin_ramp_down-1">Upper bound on the nonspinning downward reserve provision</a><a class="docs-heading-anchor-permalink" href="#constraint_max_nonspin_ramp_down-1" title="Permalink"></a></h4><div>\[\begin{aligned}
&amp; + \sum_{\substack{(u,n,d,s,t) \in nonspin\_ramp\_down\_unit\_flow\_indices: \\ (u,n,d,s,t)  \in (u,n,d,s,t)}} v_{nonspin\_ramp\_down\_unit\_flow}(u,n,d,s,t)  \\
&amp; &lt;= \\
&amp; + \sum_{\substack{(u,n,s,t) \in nonspin\_units\_shut\_down\_indices: \\ (u,n,s,t)  \in (u,n,s,t)}} v_{nonspin\_units\_shut\_down}(u,n,s,t)  \\
&amp; \cdot p_{max\_res\_shutdown\_ramp}(u,ng,d,s,t) \\
&amp; \cdot p_{unit\_capacity}(u,ng,d,t) \\
&amp; \cdot p_{conv\_cap\_to\_flow}(u,ng,d,t) \\
&amp; \forall (u,ng,d,s,t) \in ind(constraint\_max\_nonspin\_ramp)\\
\end{aligned}\]</div><h5 id="constraint_res_minimum_node_state-1"><a class="docs-heading-anchor" href="#constraint_res_minimum_node_state-1">Constraint on minimum node state for reserve provision</a><a class="docs-heading-anchor-permalink" href="#constraint_res_minimum_node_state-1" title="Permalink"></a></h5><p>Storage nodes can also contribute to the provision of reserves. The amount of balancing contributions is limited by the ramps of the sotrage unit (see above) and by the node state:</p><div>\[\begin{aligned}
&amp; v_{node\_state}(n_{stor}, s, t)\\
&amp; &gt;= p_{node\_state\_min} \\
&amp; + \sum_{\substack{(u,n_{res},d,s,t) \in unit\_flow\_indices: \\ u \in unit\_flow\_indices;n=n_{stor}) \\ p_{is\_reserve\_node}(n_{res}) }} v_{unit\_flow}(u,n_{res},d,s,t)  \\
&amp; \cdot p_{minimum\_reserve\_activation\_time}(n_{res}) \\
&amp; \forall (n_{stor},s,t) \in node\_stochastic\_time\_indices : p_{has\_state}(n)\\
\end{aligned}\]</div><h4 id="constraint_unit_flow_capacity_w_ramps-1"><a class="docs-heading-anchor" href="#constraint_unit_flow_capacity_w_ramps-1"> with ramps</a><a class="docs-heading-anchor-permalink" href="#constraint_unit_flow_capacity_w_ramps-1" title="Permalink"></a></h4><p>Currently not supported, mention issue here</p><p>[comment]: &lt;&gt; (TODO: %substract non-spinning downward; make this an energy not power balance (add delat t) %minimum up time (extended) %minimum down time (extended) %constraints max/min non spin ramp up % constraint res minimum node state %add specifics on how to define e.g. nodal balance, connection capacities for %balancing capacities %todo add new downward equations %add additional constraints on unit capacity)</p><h3 id="Operating-segments-1"><a class="docs-heading-anchor" href="#Operating-segments-1">Operating segments</a><a class="docs-heading-anchor-permalink" href="#Operating-segments-1" title="Permalink"></a></h3><h4 id="constraint_operating_point_bounds-1"><a class="docs-heading-anchor" href="#constraint_operating_point_bounds-1">Operating segments of units</a><a class="docs-heading-anchor-permalink" href="#constraint_operating_point_bounds-1" title="Permalink"></a></h4><h4 id="constraint_operating_point_sum-1"><a class="docs-heading-anchor" href="#constraint_operating_point_sum-1">Bounding unit flows by summing over operating segments</a><a class="docs-heading-anchor-permalink" href="#constraint_operating_point_sum-1" title="Permalink"></a></h4><h4 id="constraint_unit_pw_heat_rate-1"><a class="docs-heading-anchor" href="#constraint_unit_pw_heat_rate-1">Heat rate?</a><a class="docs-heading-anchor-permalink" href="#constraint_unit_pw_heat_rate-1" title="Permalink"></a></h4><h3 id="Bounds-on-commodity-flows-1"><a class="docs-heading-anchor" href="#Bounds-on-commodity-flows-1">Bounds on commodity flows</a><a class="docs-heading-anchor-permalink" href="#Bounds-on-commodity-flows-1" title="Permalink"></a></h3><h4 id="constraint_max_cum_in_unit_flow_bound-1"><a class="docs-heading-anchor" href="#constraint_max_cum_in_unit_flow_bound-1">Upper bound on cumulated unit flows</a><a class="docs-heading-anchor-permalink" href="#constraint_max_cum_in_unit_flow_bound-1" title="Permalink"></a></h4><h2 id="Network-constraints-1"><a class="docs-heading-anchor" href="#Network-constraints-1">Network constraints</a><a class="docs-heading-anchor-permalink" href="#Network-constraints-1" title="Permalink"></a></h2><h3 id="Static-constraints-2"><a class="docs-heading-anchor" href="#Static-constraints-2">Static constraints</a><a class="docs-heading-anchor-permalink" href="#Static-constraints-2" title="Permalink"></a></h3><h4 id="constraint_connection_flow_capacity-1"><a class="docs-heading-anchor" href="#constraint_connection_flow_capacity-1">Capacity constraint on connections</a><a class="docs-heading-anchor-permalink" href="#constraint_connection_flow_capacity-1" title="Permalink"></a></h4><h4 id="constraint_ratio_out_in_connection_flow-1"><a class="docs-heading-anchor" href="#constraint_ratio_out_in_connection_flow-1">Fixed ratio between outgoing and incoming flows of a connection</a><a class="docs-heading-anchor-permalink" href="#constraint_ratio_out_in_connection_flow-1" title="Permalink"></a></h4><h3 id="Network-representation-1"><a class="docs-heading-anchor" href="#Network-representation-1">Network representation</a><a class="docs-heading-anchor-permalink" href="#Network-representation-1" title="Permalink"></a></h3><h3 id="pressure-driven-gas-transfer-math-1"><a class="docs-heading-anchor" href="#pressure-driven-gas-transfer-math-1">Pressure driven gas transfer</a><a class="docs-heading-anchor-permalink" href="#pressure-driven-gas-transfer-math-1" title="Permalink"></a></h3><h4 id="constraint_max_node_pressure-1"><a class="docs-heading-anchor" href="#constraint_max_node_pressure-1">Maximum node pressure</a><a class="docs-heading-anchor-permalink" href="#constraint_max_node_pressure-1" title="Permalink"></a></h4><h4 id="constraint_min_node_pressure-1"><a class="docs-heading-anchor" href="#constraint_min_node_pressure-1">Minimum node pressure</a><a class="docs-heading-anchor-permalink" href="#constraint_min_node_pressure-1" title="Permalink"></a></h4><h4 id="constraint_compression_ratio-1"><a class="docs-heading-anchor" href="#constraint_compression_ratio-1">Constraint o the pressure ratio between to nodes</a><a class="docs-heading-anchor-permalink" href="#constraint_compression_ratio-1" title="Permalink"></a></h4><h4 id="constraint_fixed_node_pressure_point-1"><a class="docs-heading-anchor" href="#constraint_fixed_node_pressure_point-1">Outer approximation through fixed pressure points</a><a class="docs-heading-anchor-permalink" href="#constraint_fixed_node_pressure_point-1" title="Permalink"></a></h4><h4 id="constraint_storage_line_pack-1"><a class="docs-heading-anchor" href="#constraint_storage_line_pack-1">Linepack storage flexibility</a><a class="docs-heading-anchor-permalink" href="#constraint_storage_line_pack-1" title="Permalink"></a></h4><h4 id="constraint_connection_flow_gas_capacity-1"><a class="docs-heading-anchor" href="#constraint_connection_flow_gas_capacity-1">Gas connection flow capacity</a><a class="docs-heading-anchor-permalink" href="#constraint_connection_flow_gas_capacity-1" title="Permalink"></a></h4><h4 id="constraint_connection_unitary_gas_flow.jl-1"><a class="docs-heading-anchor" href="#constraint_connection_unitary_gas_flow.jl-1">Enforcing unidirectional flow</a><a class="docs-heading-anchor-permalink" href="#constraint_connection_unitary_gas_flow.jl-1" title="Permalink"></a></h4><h3 id="nodal-lossless-DC-1"><a class="docs-heading-anchor" href="#nodal-lossless-DC-1">Nodebased lossless DC power flow</a><a class="docs-heading-anchor-permalink" href="#nodal-lossless-DC-1" title="Permalink"></a></h3><h4 id="constraint_max_node_voltage_angle-1"><a class="docs-heading-anchor" href="#constraint_max_node_voltage_angle-1">Maximum node voltage angle</a><a class="docs-heading-anchor-permalink" href="#constraint_max_node_voltage_angle-1" title="Permalink"></a></h4><h4 id="constraint_min_node_voltage_angle-1"><a class="docs-heading-anchor" href="#constraint_min_node_voltage_angle-1">Minimum node voltage angle</a><a class="docs-heading-anchor-permalink" href="#constraint_min_node_voltage_angle-1" title="Permalink"></a></h4><h4 id="constraint_node_voltage_angle-1"><a class="docs-heading-anchor" href="#constraint_node_voltage_angle-1">Voltage angle to connection flows</a><a class="docs-heading-anchor-permalink" href="#constraint_node_voltage_angle-1" title="Permalink"></a></h4><h3 id="PTDF-lossless-DC-1"><a class="docs-heading-anchor" href="#PTDF-lossless-DC-1">PTDF based DC lossless powerflow ?</a><a class="docs-heading-anchor-permalink" href="#PTDF-lossless-DC-1" title="Permalink"></a></h3><h4 id="constraint_connection_flow_lodf-1"><a class="docs-heading-anchor" href="#constraint_connection_flow_lodf-1">connection flow LODF?</a><a class="docs-heading-anchor-permalink" href="#constraint_connection_flow_lodf-1" title="Permalink"></a></h4><h2 id="Investments-1"><a class="docs-heading-anchor" href="#Investments-1">Investments</a><a class="docs-heading-anchor-permalink" href="#Investments-1" title="Permalink"></a></h2><h3 id="Investments-in-units-1"><a class="docs-heading-anchor" href="#Investments-in-units-1">Investments in units</a><a class="docs-heading-anchor-permalink" href="#Investments-in-units-1" title="Permalink"></a></h3><h4 id="constraint_unit_lifetime-1"><a class="docs-heading-anchor" href="#constraint_unit_lifetime-1">Economic lifetime of a unit</a><a class="docs-heading-anchor-permalink" href="#constraint_unit_lifetime-1" title="Permalink"></a></h4><h4 id="Technical-lifetime-of-a-unit-1"><a class="docs-heading-anchor" href="#Technical-lifetime-of-a-unit-1">Technical lifetime of a unit</a><a class="docs-heading-anchor-permalink" href="#Technical-lifetime-of-a-unit-1" title="Permalink"></a></h4><h4 id="constraint_units_invested_transition-1"><a class="docs-heading-anchor" href="#constraint_units_invested_transition-1">Investment transfer</a><a class="docs-heading-anchor-permalink" href="#constraint_units_invested_transition-1" title="Permalink"></a></h4><h3 id="Investments-in-connections-1"><a class="docs-heading-anchor" href="#Investments-in-connections-1">Investments in connections</a><a class="docs-heading-anchor-permalink" href="#Investments-in-connections-1" title="Permalink"></a></h3><h3 id="constraint_connections_invested_available-1"><a class="docs-heading-anchor" href="#constraint_connections_invested_available-1">Available connection?</a><a class="docs-heading-anchor-permalink" href="#constraint_connections_invested_available-1" title="Permalink"></a></h3><h3 id="constraint_connections_invested_transition-1"><a class="docs-heading-anchor" href="#constraint_connections_invested_transition-1">Transfer of previous investments</a><a class="docs-heading-anchor-permalink" href="#constraint_connections_invested_transition-1" title="Permalink"></a></h3><h4 id="constraint_connection_flow_intact_flow-1"><a class="docs-heading-anchor" href="#constraint_connection_flow_intact_flow-1">Intact connection flows?</a><a class="docs-heading-anchor-permalink" href="#constraint_connection_flow_intact_flow-1" title="Permalink"></a></h4><h4 id="constraint_connection_intact_flow_capacity-1"><a class="docs-heading-anchor" href="#constraint_connection_intact_flow_capacity-1">Intact connection flows capacity?</a><a class="docs-heading-anchor-permalink" href="#constraint_connection_intact_flow_capacity-1" title="Permalink"></a></h4><h4 id="constraint_connection_intact_flow_ptdf-1"><a class="docs-heading-anchor" href="#constraint_connection_intact_flow_ptdf-1">Intact flow ptdf</a><a class="docs-heading-anchor-permalink" href="#constraint_connection_intact_flow_ptdf-1" title="Permalink"></a></h4><h4 id="constraint_ratio_out_in_connection_intact_flow-1"><a class="docs-heading-anchor" href="#constraint_ratio_out_in_connection_intact_flow-1">Fixed ratio between outgoing and incoming intact ? flows of a connection</a><a class="docs-heading-anchor-permalink" href="#constraint_ratio_out_in_connection_intact_flow-1" title="Permalink"></a></h4><p>Note: is this actually an investment or a network constraint?</p><h4 id="constraint_candidate_connection_flow_lb-1"><a class="docs-heading-anchor" href="#constraint_candidate_connection_flow_lb-1">Lower bound on candidate connection flow</a><a class="docs-heading-anchor-permalink" href="#constraint_candidate_connection_flow_lb-1" title="Permalink"></a></h4><h4 id="constraint_candidate_connection_flow_ub-1"><a class="docs-heading-anchor" href="#constraint_candidate_connection_flow_ub-1">Upper bound on candidate connection flow</a><a class="docs-heading-anchor-permalink" href="#constraint_candidate_connection_flow_ub-1" title="Permalink"></a></h4><h4 id="constraint_connection_lifetime-1"><a class="docs-heading-anchor" href="#constraint_connection_lifetime-1">Economic lifetime of a connection</a><a class="docs-heading-anchor-permalink" href="#constraint_connection_lifetime-1" title="Permalink"></a></h4><h4 id="Technical-lifetime-of-a-connection-1"><a class="docs-heading-anchor" href="#Technical-lifetime-of-a-connection-1">Technical lifetime of a connection</a><a class="docs-heading-anchor-permalink" href="#Technical-lifetime-of-a-connection-1" title="Permalink"></a></h4><h3 id="Investments-in-storages-1"><a class="docs-heading-anchor" href="#Investments-in-storages-1">Investments in storages</a><a class="docs-heading-anchor-permalink" href="#Investments-in-storages-1" title="Permalink"></a></h3><p>Note: can we actually invest in nodes that are not storages? (e.g. new location)</p><h4 id="constraint_storages_invested_available-1"><a class="docs-heading-anchor" href="#constraint_storages_invested_available-1">Available invested storages</a><a class="docs-heading-anchor-permalink" href="#constraint_storages_invested_available-1" title="Permalink"></a></h4><h4 id="constraint_storages_invested_transition-1"><a class="docs-heading-anchor" href="#constraint_storages_invested_transition-1">Storage capacity transfer? </a><a class="docs-heading-anchor-permalink" href="#constraint_storages_invested_transition-1" title="Permalink"></a></h4><h4 id="constraint_storage_lifetime-1"><a class="docs-heading-anchor" href="#constraint_storage_lifetime-1">Economic lifetime of a storage</a><a class="docs-heading-anchor-permalink" href="#constraint_storage_lifetime-1" title="Permalink"></a></h4><h4 id="Technical-lifetime-of-a-storage-1"><a class="docs-heading-anchor" href="#Technical-lifetime-of-a-storage-1">Technical lifetime of a storage</a><a class="docs-heading-anchor-permalink" href="#Technical-lifetime-of-a-storage-1" title="Permalink"></a></h4><h3 id="Capacity-transfer-1"><a class="docs-heading-anchor" href="#Capacity-transfer-1">Capacity transfer</a><a class="docs-heading-anchor-permalink" href="#Capacity-transfer-1" title="Permalink"></a></h3><h3 id="Early-retirement-of-capacity-1"><a class="docs-heading-anchor" href="#Early-retirement-of-capacity-1">Early retirement of capacity</a><a class="docs-heading-anchor-permalink" href="#Early-retirement-of-capacity-1" title="Permalink"></a></h3><h2 id="Benders-decomposition-1"><a class="docs-heading-anchor" href="#Benders-decomposition-1">Benders decomposition</a><a class="docs-heading-anchor-permalink" href="#Benders-decomposition-1" title="Permalink"></a></h2><p>Can we add some detail on the mathematics here</p><h3 id="constraint_mp_any_invested_cuts-1"><a class="docs-heading-anchor" href="#constraint_mp_any_invested_cuts-1">Benders cuts</a><a class="docs-heading-anchor-permalink" href="#constraint_mp_any_invested_cuts-1" title="Permalink"></a></h3><h2 id="User-constraints-1"><a class="docs-heading-anchor" href="#User-constraints-1">User constraints</a><a class="docs-heading-anchor-permalink" href="#User-constraints-1" title="Permalink"></a></h2><h3 id="constraint_unit_constraint-1"><a class="docs-heading-anchor" href="#constraint_unit_constraint-1">Unit constraint</a><a class="docs-heading-anchor-permalink" href="#constraint_unit_constraint-1" title="Permalink"></a></h3></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../variables/">« Variables</a><a class="docs-footer-nextpage" href="../objective_function/">Objective »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 13 April 2021 21:06">Tuesday 13 April 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
